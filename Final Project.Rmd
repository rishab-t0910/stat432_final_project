---
title: "Final Project"
author: "Rishab Tirupathi"
date: "2024-04-18"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
data_raw = read.csv("Interpolated WHO Data.csv")
data_raw = data_raw[, !names(data_raw) %in% c("X", "Colour")]
library(zoo)
library(reshape2)
library(ggplot2)
```

```{r}
head(data_raw)
```

### Constructing the Random Forest

```{r, warning = F, fig.width=10}
set.seed(9)
library(rpart)
predictors = c(names(data_raw))
predictors = predictors[!predictors %in% c("Life.expectancy", "Country", "Status")]

## Top 5 most useful when conducting RF with all variables

predictors = c("HIV.AIDS", "Adult.Mortality", "Income.composition.of.resources", 
               "Schooling")
response = "Life.expectancy"

train_data = read.csv("Training Data.csv")
train = train_data[, c(response, predictors)]

test_data = read.csv("Testing Data.csv")
test = test_data[, c(response, predictors)]

rf_model <- rpart(
  formula = as.formula(paste(response, "~", paste(predictors, collapse = "+"))),
  data = train)

var_imp = rf_model$variable.importance
var_imp = round(var_imp[order(var_imp, decreasing = T)]/sum(var_imp), 3)
barplot(var_imp, col = c('darkred', 'darkblue', 'darkgreen', 'purple'), 
        xlab = 'Variables', ylab = 'Percent Importance', 
        main = 'Variable importance')
```

### Checking the quality of the model
```{r}
set.seed(9)
train_pred = predict(rf_model, train)
test_pred = predict(rf_model, test)

train_pred_df = data.frame(Country = train_data$Country, Year = train_data$Year, 
                           Predicted = train_pred, Actual = train_data$Life.expectancy)
test_pred_df = data.frame(Country = test_data$Country, Year = test_data$Year,
                          Predicted = test_pred, Actual = test_data$Life.expectancy)
train_pred_df
test_pred_df

cat("Train MSE = ", mean((train_pred_df$Predicted - train_pred_df$Actual)**2))
cat("Test MSE = ", mean((test_pred_df$Predicted - test_pred_df$Actual)**2))
```

### Plotting the tree

```{r}
set.seed(9)
library(rpart.plot)
rpart.plot(rf_model)
```

### Prune the tree
- Result is the same tree

```{r}
set.seed(9)
optimal_tree = prune(rf_model, cp = rf_model$cptable[which.min(rf_model$cptable[, "xerror"]), "CP"])
rpart.plot(optimal_tree)
```

