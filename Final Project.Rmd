---
title: "Final Project"
author: "Rishab Tirupathi"
date: "2024-04-18"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
data_raw = read.csv("Life Expectancy Data.csv")
```

```{r}
head(data_raw)
```

### Constructing the Random Forest

```{r, warning = F}
set.seed(7)
library(rpart)

## Encode status
data_raw$Status.num = ifelse(data_raw$Status == 'Developing', 0, 1)

## Encode countries
unique_countries = unique(data_raw$Country)
country_encoding = as.numeric(factor(unique_countries))
country_mapping = setNames(country_encoding, unique_countries)
data_raw$Country_num = country_mapping[data_raw$Country]

# predictors = c(names(data_raw))
# predictors = predictors[!predictors %in% c("Life.expectancy", "Country", "Status")]

## Top 5 most useful when conducting RF with all variables

predictors = c("Income.composition.of.resources", "Schooling", "HIV.AIDS", 
               "Adult.Mortality", "thinness.1.19.years") 
response = "Life.expectancy"

data_modelling = data_raw
data_modelling = na.omit(data_modelling)

train_id = sample(1:nrow(data_modelling), 0.8 * nrow(data_modelling))
train = data_modelling[train_id, ]
test = data_modelling[-train_id,]

rf_model <- rpart(
  formula = as.formula(paste(response, "~", paste(predictors, collapse = "+"))),
  data = train)

var_imp = rf_model$variable.importance
var_imp = round(var_imp[order(var_imp, decreasing = T)]/max(var_imp), 3)
var_imp = var_imp[1:5]
```

### Checking the quality of the model
```{r}
set.seed(7)
train_pred = predict(rf_model, train)
test_pred = predict(rf_model, test)

train_pred_df = data.frame(Country = train$Country, Year = train$Year, 
                           Predicted = train_pred, Actual = train$Life.expectancy)
test_pred_df = data.frame(Country = test$Country, Year = test$Year,
                          Predicted = test_pred, Actual = test$Life.expectancy)
train_pred_df
test_pred_df

cat("Train MSE = ", mean((train_pred_df$Predicted - train_pred_df$Actual)**2))
cat("Test MSE = ", mean((test_pred_df$Predicted - test_pred_df$Actual)**2))
```

### Plotting the tree

```{r}
set.seed(7)
library(rpart.plot)
rpart.plot(rf_model)
```

